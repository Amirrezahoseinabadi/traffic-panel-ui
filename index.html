Skip to content
Navigation Menu
Amirrezahoseinabadi
traffic-panel-ui

Type / to search
Code
Issues
Pull requests
Actions
Projects
Wiki
Security
Insights
Settings
Commit ff97ff6
Amirrezahoseinabadi
Amirrezahoseinabadi
authored
26 minutes ago
·
·
Verified
Update index.html
main
1 parent 
cee680e
 commit 
ff97ff6
File tree
Filter files…
index.html
1 file changed
+195
-146
lines changed
Search within code
 
‎index.html
+۱۹۵
-۱۴۶
Lines changed: 195 additions & 146 deletions
Original file line number	Diff line number	Diff line change
@@ -388,42 +388,78 @@ <h1 class="text-3xl sm:text-4xl font-bold text-center mb-10" data-key="mainHeade
        </div>

        <div id="dashboardContent" class="hidden">
            <div id="adminStats" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5 mb-10 mx-auto">
                <div class="card">
                    <p class="text-sm mb-2" data-key="totalVolume">حجم کلی پنل</p>
                    <p id="adminTotalVolume" class="text-3xl">...</p>
                </div>
                <div class="card">
                    <p class="text-sm mb-2" data-key="consumed">مصرفی پنل</p>
                    <p id="adminConsumed" class="text-3xl">...</p>
                </div>
                <div class="card">
                    <p class="text-sm mb-2" data-key="remainingVolume">باقیمانده پنل</p>
                    <p id="adminRemaining" class="text-3xl">...</p>
                </div>
                <div class="card">
                    <p class="text-sm mb-2" data-key="adminCreationDate">تاریخ ساخت ادمین</p>
                    <p id="adminCreationDateValue" class="text-lg">...</p>
                </div>
                <div class="card col-span-full lg:col-span-1">
                    <p class="text-sm mb-2" data-key="adminDaysPassed">مدت زمان ساخت ادمین</p>
                    <p id="adminDaysPassedValue" class="text-3xl">...</p>
                </div>
            </div>
            <div id="userUsageLists" class="grid grid-cols-1 md:grid-cols-2 gap-5 mb-10 mx-auto">
                <div class="card">
                    <h2 class="text-xl font-semibold text-blue-400 mb-4 text-right" data-key="topUsersHeader">۵ کاربر پرمصرف</h2>
                    <ul id="topUsersList" class="list-disc pr-5 text-gray-300">
                        </ul>
                </div>
                <div class="card">
                    <h2 class="text-xl font-semibold text-blue-400 mb-4 text-right" data-key="leastUsersHeader">۵ کاربر کم‌مصرف</h2>
                    <ul id="leastUsersList" class="list-disc pr-5 text-gray-300">
                        </ul>
                </div>
            </div>
            <div class="card mb-10 w-full max-w-md mx-auto">
                <label for="usernameInput" class="text-lg mb-4 text-center" data-key="usernameLabel">نام کاربری کاربر را وارد کنید:</label>
                <input type="text" id="usernameInput" placeholder="مثال: dehghan_sa" class="w-full max-w-md mb-6 text-center">
                <button id="fetchDataButton" class="main-button" data-key="fetchDataButton">دریافت اطلاعات</button>
                <button id="fetchDataButton" class="main-button" data-key="fetchDataButton">دریافت اطلاعات کاربر</button>
            </div>

            <div id="loadingIndicator" class="loading-spinner hidden"></div>
            <p id="errorMessage" class="text-red-500 text-center mt-6 hidden" data-key="errorMessage">خطا در دریافت اطلاعات. لطفا دوباره تلاش کنید.</p>

            <div id="dataCards" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5 mb-10 hidden mx-auto">
                <div class="card">
                    <p class="text-sm mb-2" data-key="totalVolume">حجم کلی</p>
                    <p class="text-sm mb-2" data-key="totalVolume">حجم کلی کاربر</p>
                    <p id="total2" class="text-3xl">...</p>
                </div>
                <div class="card">
                    <p class="text-sm mb-2" data-key="remainingVolume">حجم باقیمانده</p>
                    <p class="text-sm mb-2" data-key="remainingVolume">حجم باقیمانده کاربر</p>
                    <p id="baghi" class="text-3xl">...</p>
                </div>
                <div class="card">
                    <p class="text-sm mb-2" data-key="consumed">مصرفی</p>
                    <p class="text-sm mb-2" data-key="consumed">مصرفی کاربر</p>
                    <p id="usage" class="text-3xl">...</p>
                </div>
                <div class="card">
                    <p class="text-sm mb-2" data-key="creationDate">تاریخ ساخت</p>
                    <p class="text-sm mb-2" data-key="creationDate">تاریخ ساخت کاربر</p>
                    <p id="date3" class="text-lg">...</p> </div>
                <div class="card col-span-full lg:col-span-1">
                    <p class="text-sm mb-2" data-key="daysPassed">مدت زمان ساخت</p>
                    <p class="text-sm mb-2" data-key="daysPassed">مدت زمان ساخت کاربر</p>
                    <p id="date2" class="text-3xl">...</p>
                </div>
            </div>

            <div id="chartContainer" class="chart-container hidden mx-auto">
                <div class="flex justify-between items-center mb-5 flex-wrap">
                    <div>
                        <h2 class="chart-title mb-1" data-key="trafficChartHeader">نمودار مصرف ترافیک</h2>
                        <p class="chart-subtitle" data-key="trafficChartSubtitle">ترافیک مصرفی شما بر اساس بازه زمانی انتخابی</p>
                        <h2 class="chart-title mb-1" data-key="trafficChartHeader">نمودار مصرف ترافیک کاربر</h2>
                        <p class="chart-subtitle" data-key="trafficChartSubtitle">ترافیک مصرفی کاربر بر اساس بازه زمانی انتخابی</p>
                    </div>
                    <div class="flex space-x-2 mt-4 sm:mt-0" dir="ltr"> 
                        <button class="time-range-button active" data-range="24h">24H</button>
@@ -437,19 +473,6 @@ <h2 class="chart-title mb-1" data-key="trafficChartHeader">نمودار مصرف
                    <canvas id="trafficChart"></canvas>
                </div>
            </div>
            <div id="userUsageLists" class="grid grid-cols-1 md:grid-cols-2 gap-5 mb-10 mx-auto hidden">
                <div class="card">
                    <h2 class="text-xl font-semibold text-blue-400 mb-4 text-right" data-key="topUsersHeader">۵ کاربر پرمصرف</h2>
                    <ul id="topUsersList" class="list-disc pr-5 text-gray-300">
                        </ul>
                </div>
                <div class="card">
                    <h2 class="text-xl font-semibold text-blue-400 mb-4 text-right" data-key="leastUsersHeader">۵ کاربر کم‌مصرف</h2>
                    <ul id="leastUsersList" class="list-disc pr-5 text-gray-300">
                        </ul>
                </div>
            </div>
        </div>
    </div>

@@ -482,21 +505,28 @@ <h2 class="text-xl font-semibold text-blue-400 mb-4 text-right" data-key="leastU
        const loginErrorMessage = document.getElementById('loginErrorMessage');
        const dashboardContent = document.getElementById('dashboardContent');

        const adminTotalVolume = document.getElementById('adminTotalVolume');
        const adminConsumed = document.getElementById('adminConsumed');
        const adminRemaining = document.getElementById('adminRemaining');
        const adminCreationDateValue = document.getElementById('adminCreationDateValue');
        const adminDaysPassedValue = document.getElementById('adminDaysPassedValue');
        const usernameInput = document.getElementById('usernameInput');
        const fetchDataButton = document.getElementById('fetchDataButton');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const errorMessage = document.getElementById('errorMessage');
        const dataCards = document.getElementById('dataCards');
        const chartContainer = document.getElementById('chartContainer');
        const userUsageLists = document.getElementById('userUsageLists'); // New: User usage lists container
        const topUsersList = document.getElementById('topUsersList');     // New: Top users list
        const leastUsersList = document.getElementById('leastUsersList'); // New: Least users list
        const userUsageLists = document.getElementById('userUsageLists');
        const topUsersList = document.getElementById('topUsersList');
        const leastUsersList = document.getElementById('leastUsersList');

        let trafficChart;
        let currentTrafficData = {};
        let currentTrafficData = {}; // For individual user data
        let currentLanguage = localStorage.getItem('language') || 'fa';
        let currentTheme = localStorage.getItem('theme') || 'dark';
        let accessToken = localStorage.getItem('marzban_access_token') || null; // Store access token
        let accessToken = localStorage.getItem('marzban_access_token') || null;
        let adminUsername = localStorage.getItem('marzban_admin_username') || null; // Store admin username

        const CLOUDFLARE_WORKER_URL = 'https://home-vor.amiruserbot7.workers.dev/';

@@ -505,17 +535,17 @@ <h2 class="text-xl font-semibold text-blue-400 mb-4 text-right" data-key="leastU
                pageTitle: 'پنل جزئیات مصرف شما', 
                mainHeader: 'پنل جزئیات مصرف شما', 
                usernameLabel: 'نام کاربری کاربر را وارد کنید:',
                fetchDataButton: 'دریافت اطلاعات',
                fetchDataButton: 'دریافت اطلاعات کاربر',
                errorMessage: 'خطا در دریافت اطلاعات. لطفا دوباره تلاش کنید.',
                invalidUsernameError: 'نام کاربری وارد شده نامعتبر است. لطفاً از صحت نام کاربری اطمینان حاصل کرده و مجدداً تلاش فرمایید.',
                fetchErrorGeneric: 'خطا در دریافت اطلاعات: {error}. لطفا نام کاربری را بررسی کرده، از فعال بودن Cloudflare Worker خود مطمئن شوید و بررسی کنید که CORS در Worker شما به درستی تنظیم شده باشد.',
                totalVolume: 'حجم کلی',
                remainingVolume: 'حجم باقیمانده',
                consumed: 'مصرفی',
                creationDate: 'تاریخ ساخت',
                daysPassed: 'مدت زمان ساخت',
                trafficChartHeader: 'نمودار مصرف ترافیک',
                trafficChartSubtitle: 'ترافیک مصرفی شما بر اساس بازه زمانی انتخابی',
                totalVolume: 'حجم کلی کاربر',
                remainingVolume: 'حجم باقیمانده کاربر',
                consumed: 'مصرفی کاربر',
                creationDate: 'تاریخ ساخت کاربر',
                daysPassed: 'مدت زمان ساخت کاربر',
                trafficChartHeader: 'نمودار مصرف ترافیک کاربر',
                trafficChartSubtitle: 'ترافیک مصرفی کاربر بر اساس بازه زمانی انتخابی',
                notAvailable: 'در دسترس نیست',
                invalidDateFormat: 'فرمت تاریخ نامعتبر', 
                daysUnit: 'روز',
@@ -535,23 +565,28 @@ <h2 class="text-xl font-semibold text-blue-400 mb-4 text-right" data-key="leastU
                loginErrorMessage: 'نام کاربری یا رمز عبور اشتباه است.',
                topUsersHeader: '۵ کاربر پرمصرف',
                leastUsersHeader: '۵ کاربر کم‌مصرف',
                noUsersFound: 'کاربری یافت نشد.'
                noUsersFound: 'کاربری یافت نشد.',
                adminTotalVolume: 'حجم کلی پنل',
                adminConsumed: 'مصرفی پنل',
                adminRemaining: 'باقیمانده پنل',
                adminCreationDate: 'تاریخ ساخت ادمین',
                adminDaysPassed: 'مدت زمان ساخت ادمین'
            },
            en: {
                pageTitle: 'Your Usage Details Panel', 
                mainHeader: 'Your Usage Details Panel', 
                usernameLabel: 'Enter User Username:',
                fetchDataButton: 'Fetch Data',
                fetchDataButton: 'Fetch User Data',
                errorMessage: 'Error fetching data. Please try again.',
                invalidUsernameError: 'The entered username is invalid. Please ensure the username is correct and try again.',
                fetchErrorGeneric: 'Error fetching data: {error}. Please check the username, ensure your Cloudflare Worker is active, and verify CORS settings on your Worker.',
                totalVolume: 'Total Volume',
                remainingVolume: 'Remaining Volume',
                consumed: 'Consumed',
                creationDate: 'Creation Date',
                daysPassed: 'Days Passed',
                trafficChartHeader: 'Traffic Consumption Chart',
                trafficChartSubtitle: 'Your traffic consumption based on the selected time range',
                totalVolume: 'Total User Volume',
                remainingVolume: 'Remaining User Volume',
                consumed: 'User Consumed',
                creationDate: 'User Creation Date',
                daysPassed: 'User Days Passed',
                trafficChartHeader: 'User Traffic Consumption Chart',
                trafficChartSubtitle: 'User traffic consumption based on the selected time range',
                notAvailable: 'Not Available',
                invalidDateFormat: 'Invalid Date Format',
                daysUnit: 'days',
@@ -571,7 +606,12 @@ <h2 class="text-xl font-semibold text-blue-400 mb-4 text-right" data-key="leastU
                loginErrorMessage: 'Incorrect username or password.',
                topUsersHeader: 'Top 5 Consuming Users',
                leastUsersHeader: 'Least 5 Consuming Users',
                noUsersFound: 'No users found.'
                noUsersFound: 'No users found.',
                adminTotalVolume: 'Total Panel Volume',
                adminConsumed: 'Panel Consumed',
                adminRemaining: 'Panel Remaining',
                adminCreationDate: 'Admin Creation Date',
                adminDaysPassed: 'Admin Days Passed'
            }
        };

@@ -601,8 +641,9 @@ <h2 class="text-xl font-semibold text-blue-400 mb-4 text-right" data-key="leastU
            htmlElement.setAttribute('dir', lang === 'fa' ? 'rtl' : 'ltr');
            bodyElement.setAttribute('dir', lang === 'fa' ? 'rtl' : 'ltr');

            // Re-render chart if already initialized
            if (trafficChart) {
                updateUI(currentTrafficData);
                updateChart(currentTrafficData.usage, currentTrafficData.usage_unit);
            }
        }

@@ -618,18 +659,15 @@ <h2 class="text-xl font-semibold text-blue-400 mb-4 text-right" data-key="leastU
            currentTheme = theme;
        }

        function initializePreferences() {
        async function initializePreferences() {
            setTheme(currentTheme);
            languageSelector.value = currentLanguage;
            applyTranslations(currentLanguage);

            // Check for existing token on load
            if (accessToken) {
            if (accessToken && adminUsername) {
                loginForm.classList.add('hidden');
                dashboardContent.classList.remove('hidden');
                // Optionally, fetch initial data for the dashboard here if needed
                // fetchDataButton.click(); // Or fetch a default user's data
                fetchUserLists(); // Fetch top/least users on dashboard load
                await fetchDashboardInitialData(); // Fetch all dashboard data after successful login
            } else {
                loginForm.classList.remove('hidden');
                dashboardContent.classList.add('hidden');
@@ -673,14 +711,14 @@ <h2 class="text-xl font-semibold text-blue-400 mb-4 text-right" data-key="leastU
            const password = loginPasswordInput.value.trim();

            if (!username || !password) {
                loginErrorMessage.textContent = translations[currentLanguage].loginErrorMessage; // "نام کاربری یا رمز عبور اشتباه است."
                loginErrorMessage.textContent = translations[currentLanguage].loginErrorMessage;
                loginErrorMessage.classList.remove('hidden');
                return;
            }

            loginButton.disabled = true;
            loginErrorMessage.classList.add('hidden');
            loadingIndicator.classList.remove('hidden');
            loadingIndicator.classList.remove('hidden'); // Use main loading indicator

            try {
                const response = await fetch(`${CLOUDFLARE_WORKER_URL}login`, {
@@ -698,26 +736,111 @@ <h2 class="text-xl font-semibold text-blue-400 mb-4 text-right" data-key="leastU

                const data = await response.json();
                accessToken = data.access_token;
                adminUsername = username; // Store the logged-in admin's username
                localStorage.setItem('marzban_access_token', accessToken);
                localStorage.setItem('marzban_admin_username', adminUsername);

                loginForm.classList.add('hidden');
                dashboardContent.classList.remove('hidden');
                loadingIndicator.classList.add('hidden');

                // Fetch user lists immediately after successful login
                fetchUserLists();
                await fetchDashboardInitialData(); // Fetch all dashboard data after successful login

            } catch (error) {
                console.error('Login error:', error);
                loginErrorMessage.textContent = error.message;
                loginErrorMessage.classList.remove('hidden');
                loadingIndicator.classList.add('hidden');
            } finally {
                loginButton.disabled = false;
                loadingIndicator.classList.add('hidden'); // Hide loading indicator
            }
        });

        // --- Fetch Individual User Data Logic (Existing) ---
        // --- Fetch Dashboard Initial Data (Admin's overall stats + User Lists) ---
        async function fetchDashboardInitialData() {
            if (!accessToken || !adminUsername) {
                console.warn("No access token or admin username available for initial dashboard fetch.");
                loginForm.classList.remove('hidden');
                dashboardContent.classList.add('hidden');
                return;
            }
            loadingIndicator.classList.remove('hidden');
            errorMessage.classList.add('hidden');
            // Hide all dashboard sections initially
            document.getElementById('adminStats').classList.add('hidden');
            userUsageLists.classList.add('hidden');
            dataCards.classList.add('hidden'); // Hide individual user data
            chartContainer.classList.add('hidden'); // Hide individual user chart
            try {
                const response = await fetch(`${CLOUDFLARE_WORKER_URL}dashboard-init?admin_username=${adminUsername}`, {
                    headers: {
                        'Authorization': `Bearer ${accessToken}`
                    }
                });
                if (!response.ok) {
                    const errorData = await response.json();
                    if (response.status === 401) {
                        localStorage.removeItem('marzban_access_token');
                        localStorage.removeItem('marzban_admin_username');
                        accessToken = null;
                        adminUsername = null;
                        loginForm.classList.remove('hidden');
                        dashboardContent.classList.add('hidden');
                        loginErrorMessage.textContent = translations[currentLanguage].loginErrorMessage;
                        loginErrorMessage.classList.remove('hidden');
                        return;
                    }
                    throw new Error(errorData.error || `Failed to fetch dashboard data: ${response.statusText}`);
                }
                const data = await response.json();
                console.log("Initial Dashboard Data:", data);
                // Update Admin's Overall Stats
                adminTotalVolume.textContent = data.admin_total_volume || translations[currentLanguage].unknown;
                adminConsumed.textContent = data.admin_consumed_volume || translations[currentLanguage].unknown;
                adminRemaining.textContent = data.admin_remaining_volume || translations[currentLanguage].unknown;
                adminCreationDateValue.textContent = data.admin_creation_date || translations[currentLanguage].unknown;
                adminDaysPassedValue.textContent = data.admin_days_passed ? `${data.admin_days_passed} ${translations[currentLanguage].daysUnit}` : translations[currentLanguage].unknown;
                document.getElementById('adminStats').classList.remove('hidden');
                // Update Top/Least Consuming Users
                topUsersList.innerHTML = '';
                leastUsersList.innerHTML = '';
                if (data.top_users && data.top_users.length > 0) {
                    data.top_users.forEach(user => {
                        const li = document.createElement('li');
                        li.textContent = `${user.username}: ${user.used_traffic_formatted}`;
                        topUsersList.appendChild(li);
                    });
                } else {
                    topUsersList.innerHTML = `<li>${translations[currentLanguage].noUsersFound}</li>`;
                }
                if (data.least_users && data.least_users.length > 0) {
                    data.least_users.forEach(user => {
                        const li = document.createElement('li');
                        li.textContent = `${user.username}: ${user.used_traffic_formatted}`;
                        leastUsersList.appendChild(li);
                    });
                } else {
                    leastUsersList.innerHTML = `<li>${translations[currentLanguage].noUsersFound}</li>`;
                }
                userUsageLists.classList.remove('hidden');
            } catch (error) {
                console.error('Error fetching initial dashboard data:', error);
                errorMessage.textContent = error.message;
                errorMessage.classList.remove('hidden');
            } finally {
                loadingIndicator.classList.add('hidden');
            }
        }
        // --- Fetch Individual User Data Logic (Existing, now called by button) ---
        fetchDataButton.addEventListener('click', async () => {
            const username = usernameInput.value.trim();
            if (!username) {
@@ -732,8 +855,9 @@ <h2 class="text-xl font-semibold text-blue-400 mb-4 text-right" data-key="leastU
            chartContainer.classList.add('hidden');

            try {
                const fetchUrl = `${CLOUDFLARE_WORKER_URL}?username=${username}`; // Still uses main worker route for individual user data
                console.log('Fetching data from:', fetchUrl);
                // This route still uses the main worker route for individual user data from a.php
                const fetchUrl = `${CLOUDFLARE_WORKER_URL}?username=${username}`;
                console.log('Fetching individual user data from:', fetchUrl);

                const response = await fetch(fetchUrl);

@@ -756,14 +880,14 @@ <h2 class="text-xl font-semibold text-blue-400 mb-4 text-right" data-key="leastU
                    return;
                }

                currentTrafficData = data;
                updateUI(data);
                currentTrafficData = data; // Store for chart re-rendering
                updateIndividualUserDataUI(data);

                dataCards.classList.remove('hidden');
                chartContainer.classList.remove('hidden');

            } catch (error) {
                console.error('Error fetching data:', error);
                console.error('Error fetching individual user data:', error);
                errorMessage.textContent = translations[currentLanguage].fetchErrorGeneric.replace('{error}', error.message);
                errorMessage.classList.remove('hidden');
                dataCards.classList.add('hidden');
@@ -773,74 +897,8 @@ <h2 class="text-xl font-semibold text-blue-400 mb-4 text-right" data-key="leastU
            }
        });

        // --- New: Fetch Top/Least Consuming Users ---
        async function fetchUserLists() {
            if (!accessToken) {
                console.warn("No access token available. Cannot fetch user lists.");
                userUsageLists.classList.add('hidden');
                return;
            }
            topUsersList.innerHTML = ''; // Clear previous lists
            leastUsersList.innerHTML = '';
            userUsageLists.classList.add('hidden'); // Hide until loaded
            try {
                const response = await fetch(`${CLOUDFLARE_WORKER_URL}users-summary`, {
                    headers: {
                        'Authorization': `Bearer ${accessToken}`
                    }
                });
                if (!response.ok) {
                    if (response.status === 401) {
                        console.error("Unauthorized: Access token might be expired or invalid. Please log in again.");
                        localStorage.removeItem('marzban_access_token');
                        accessToken = null;
                        loginForm.classList.remove('hidden');
                        dashboardContent.classList.add('hidden');
                        loginErrorMessage.textContent = translations[currentLanguage].loginErrorMessage; // Or a specific "Session expired" message
                        loginErrorMessage.classList.remove('hidden');
                    }
                    const errorData = await response.json();
                    throw new Error(errorData.error || `Failed to fetch user lists: ${response.statusText}`);
                }
                const data = await response.json();
                console.log("User summary data:", data);
                if (data.top_users && data.top_users.length > 0) {
                    data.top_users.forEach(user => {
                        const li = document.createElement('li');
                        li.textContent = `${user.username}: ${user.used_traffic_formatted}`;
                        topUsersList.appendChild(li);
                    });
                } else {
                    topUsersList.innerHTML = `<li>${translations[currentLanguage].noUsersFound}</li>`;
                }
                if (data.least_users && data.least_users.length > 0) {
                    data.least_users.forEach(user => {
                        const li = document.createElement('li');
                        li.textContent = `${user.username}: ${user.used_traffic_formatted}`;
                        leastUsersList.appendChild(li);
                    });
                } else {
                    leastUsersList.innerHTML = `<li>${translations[currentLanguage].noUsersFound}</li>`;
                }
                userUsageLists.classList.remove('hidden');
            } catch (error) {
                console.error('Error fetching user lists:', error);
                // Display error in the user list section or general error message
                topUsersList.innerHTML = `<li>Error: ${error.message}</li>`;
                leastUsersList.innerHTML = `<li>Error: ${error.message}</li>`;
                userUsageLists.classList.remove('hidden'); // Show container even with error
            }
        }
        function updateUI(data) {
        // Function to update the UI elements for individual user data (total2, baghi, usage, date3, date2, chart)
        function updateIndividualUserDataUI(data) {
            const currentTrans = translations[currentLanguage];

            document.getElementById('total2').textContent = data.total2 || currentTrans.unknown;
@@ -883,22 +941,13 @@ <h2 class="text-xl font-semibold text-blue-400 mb-4 text-right" data-key="leastU

            document.getElementById('date2').textContent = data.date2 ? `${data.date2} ${currentTrans.daysUnit}` : currentTrans.unknown;

            const usageValue = parseFloat(data.usage); 
            let usageUnit = '';
            if (data.usage && typeof data.usage === 'string') {
                const unitMatch = data.usage.match(/[A-Z]+/i);
                if (unitMatch) {
                    const unit = unitMatch[0].toLowerCase();
                    if (unit === 'b') usageUnit = currentTrans.bytes;
                    else if (unit === 'mb') usageUnit = currentTrans.mb;
                    else if (unit === 'gb') usageUnit = currentTrans.gb;
                    else if (unit === 'tb') usageUnit = currentTrans.tb;
                    else usageUnit = unitMatch[0];
                }
            } else {
                usageUnit = currentTrans.mb;
            }
            updateChart(data.usage, data.usage_unit); // Pass usage and its unit for chart
        }

        function updateChart(usageString, usageUnit) {
            const currentTrans = translations[currentLanguage];
            const usageValue = parseFloat(usageString); 
            
            const ctx = document.getElementById('trafficChart').getContext('2d');

            if (trafficChart) {
0 commit comments
Comments
0
 (0)
Comment
You're not receiving notifications from this thread.

Update index.html · Amirrezahoseinabadi/traffic-panel-ui@ff97ff6 
توضیح دادن
